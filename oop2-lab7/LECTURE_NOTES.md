# üìò –õ–ï–ö–¶–ò–Ø 7 - –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ shared state

## –°–≤—è–∑—å —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –Ω–µ–¥–µ–ª—è–º–∏

**–ß—Ç–æ –º—ã —É–∂–µ –∑–Ω–∞–µ–º:**
- –ê–∫—Ç–æ—Ä—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–º—É
- Mailbox –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ù–µ—Ç shared mutable state –º–µ–∂–¥—É –∞–∫—Ç–æ—Ä–∞–º–∏

**–ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å:** –ì–¥–µ –∏ –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∞–∫—Ç–æ—Ä–µ, –µ—Å–ª–∏ mutable state –∑–∞–ø—Ä–µ—â—ë–Ω?

**–û—Ç–≤–µ—Ç:** –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏, –∞ –Ω–µ –≤ –ø–æ–ª—è—Ö –æ–±—ä–µ–∫—Ç–∞!

---

## –û—à–∏–±–æ—á–Ω—ã–π ¬´–æ–±—ä–µ–∫—Ç–Ω—ã–π¬ª –ø–æ–¥—Ö–æ–¥ ‚ùå

```java
class CounterActor {
    private int value = 0; // ‚ùå BAD!

    Behavior<Command> behavior() {
        return Behaviors.receiveMessage(msg -> {
            value++; // ‚ùå Mutable state
            return Behaviors.same();
        });
    }
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ:**
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ –≤ –ø–æ–ª–µ
- –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º—ã—Ç–∞
- –°–ª–æ–∂–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É —Å—Ç–∏–ª—é

**–≠—Ç–æ "–∞–∫—Ç–æ—Ä –∫–∞–∫ –æ–±—ä–µ–∫—Ç", –∞ –Ω–µ actor model!**

---

## –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚úÖ

**–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ–≤–µ–¥–µ–Ω–∏—è:**
```java
Behavior<Command> behavior(State state)
```

–í Akka Typed:
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —è–≤–Ω–æ
- –ö–∞–∂–¥–æ–µ –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí –Ω–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–ù–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π. –í—Å—ë –≤–∏–¥–Ω–æ.**

---

## Immutable State ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

–°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–æ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- **Immutable** ‚Äî –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–µ
- **–ó–∞–º–µ–Ω—è–µ–º—ã–º**, –∞ –Ω–µ –∏–∑–º–µ–Ω—è–µ–º—ã–º
- **–ü—Ä–æ—Å—Ç—ã–º –æ–±—ä–µ–∫—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö**

```java
class State {
    final int value; // final ‚Üí –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å

    State(int value) {
        this.value = value;
    }

    State increment() {
        return new State(value + 1); // –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç!
    }
}
```

**–ó–¥–µ—Å—å:**
- `final` ‚Üí –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å
- –ö–∞–∂–¥–æ–µ ¬´–∏–∑–º–µ–Ω–µ–Ω–∏–µ¬ª ‚Üí –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç

---

## Behavior Switching ‚Äî –∫–ª—é—á–µ–≤–∞—è –∏–¥–µ—è

**Behavior switching –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ê–∫—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å —Å–≤–æ—ë –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –°–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–æ-–¥—Ä—É–≥–æ–º—É

**–≠—Ç–æ –∞–Ω–∞–ª–æ–≥ state machine, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π**

---

## –ü—Ä–∏–º–µ—Ä: –°—á—ë—Ç—á–∏–∫ –∫–∞–∫ State Machine

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞

**–°–æ–æ–±—â–µ–Ω–∏—è:**
- Increment ‚Äî —É–≤–µ–ª–∏—á–∏—Ç—å
- GetValue ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CounterActor

### 1. –°–æ–æ–±—â–µ–Ω–∏—è
```java
interface Command {}

class Increment implements Command {}

class PrintValue implements Command {}
```

### 2. –°–æ—Å—Ç–æ—è–Ω–∏–µ
```java
class CounterState {
    final int value;

    CounterState(int value) {
        this.value = value;
    }

    CounterState increment() {
        return new CounterState(value + 1);
    }
}
```

### 3. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∞–∫—Ç–æ—Ä–∞
```java
class CounterActor {

    static Behavior<Command> create() {
        return behavior(new CounterState(0));
    }

    private static Behavior<Command> behavior(CounterState state) {
        return Behaviors.receiveMessage(msg -> {

            if (msg instanceof Increment) {
                CounterState newState = state.increment();
                return behavior(newState); // üîÅ –ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
            }

            if (msg instanceof PrintValue) {
                System.out.println("Value = " + state.value);
                return Behaviors.same();
            }

            return Behaviors.same();
        });
    }
}
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- –ù–µ—Ç –ø–æ–ª–µ–π
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
- `return behavior(newState)` = —Å–º–µ–Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è

---

## –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ mutable-–ø–æ–ª–µ–π

- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–Ω–æ —è–≤–Ω–æ
- ‚úÖ –ù–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ —Å–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å message-driven –º–æ–¥–µ–ª—å—é

**–≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∞–∫—Ç–æ—Ä–æ–≤**

---

## –ê–∫—Ç–æ—Ä –∫–∞–∫ –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç (FSM)

> **–ê–∫—Ç–æ—Ä ‚Äî —ç—Ç–æ –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç, —Ä–µ–∞–≥–∏—Ä—É—é—â–∏–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**

- **–°–æ—Å—Ç–æ—è–Ω–∏–µ** ‚Üí –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- **–°–æ–æ–±—â–µ–Ω–∏–µ** ‚Üí –ø–µ—Ä–µ—Ö–æ–¥
- **–ù–∏–∫–∞–∫–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**

---

## –ü–æ—á–µ–º—É —ç—Ç–æ –≥–æ—Ç–æ–≤–∏—Ç –∫ Persistence

–ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- Immutable
- –í—ã—Ä–∞–∂–µ–Ω–æ —è–≤–Ω–æ
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è

–¢–æ –µ–≥–æ:
- –õ–µ–≥–∫–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
- –õ–µ–≥–∫–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å
- –õ–µ–≥–∫–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å

**–≠—Ç–æ –ø—Ä—è–º–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ Akka Persistence**

---

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

‚ùå –•—Ä–∞–Ω–∏—Ç—å state –≤ –ø–æ–ª—è—Ö  
‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å static  
‚ùå –ú—É—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã  
‚ùå –ü—ã—Ç–∞—Ç—å—Å—è ¬´–≤–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ¬ª

---

## –ó–∞–¥–∞–Ω–∏—è –∏–∑ –ª–µ–∫—Ü–∏–∏

### –ó–∞–¥–∞–Ω–∏–µ 1: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CounterActor
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ –ª–µ–∫—Ü–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ Reset
- –°–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ 0

### –ó–∞–¥–∞–Ω–∏–µ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `Add(int amount)`
- –û–±–Ω–æ–≤–∏—Ç—å CounterState

### –ó–∞–¥–∞–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è
–í main:
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ Increment
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å Add(10)
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å PrintValue
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å Reset
- –°–Ω–æ–≤–∞ PrintValue

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **–ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å state –≤ –ø–æ–ª—è—Ö –∞–∫—Ç–æ—Ä–∞?**
2. **–ß—Ç–æ —Ç–∞–∫–æ–µ behavior switching?**
3. **–ß–µ–º –∞–∫—Ç–æ—Ä –ø–æ—Ö–æ–∂ –Ω–∞ state machine?**
4. **–ü–æ—á–µ–º—É state –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å immutable?**
5. **–ö–∞–∫ behavior —Å–≤—è–∑–∞–Ω —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º?**

---

## –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ –ù–µ–¥–µ–ª–∏ 7 —Å—Ç—É–¥–µ–Ω—Ç:
- ‚úÖ –ü–æ–Ω–∏–º–∞–µ—Ç, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–æ—Ä–∞
- ‚úÖ –£–º–µ–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å state machine
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç behavior switching
- ‚úÖ –ú—ã—Å–ª–∏—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ –∞–∫—Ç–æ—Ä–æ–≤
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ supervision –∏ –æ—Ç–∫–∞–∑–∞–º
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º–µ ‚Äî —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

---

## –°–≤—è–∑—å —Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π

–í –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ ‚Ññ7 –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º:

1. ‚úÖ CounterState ‚Äî immutable –∫–ª–∞—Å—Å
2. ‚úÖ CounterActor ‚Äî —Å behavior switching
3. ‚úÖ –ö–æ–º–∞–Ω–¥—ã: Increment, PrintValue, Reset, Add
4. ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é FSM
5. ‚úÖ –í—Å–µ –∑–∞–¥–∞–Ω–∏—è –∏–∑ –ª–µ–∫—Ü–∏–∏

**–ò–∑—É—á–∏—Ç–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã!**
